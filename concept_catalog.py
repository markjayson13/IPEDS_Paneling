"""Concept catalog for label-driven IPEDS harmonization.

This module exposes the ``CONCEPTS`` dictionary used by ``harmonize_new`` to
identify and extract concept-aligned variables from IPEDS survey files. The
catalog replaces CSV crosswalks with an in-repo Python source of truth. Each
concept entry specifies its descriptive metadata, acceptable forms, matching
patterns, and transform hints.

The harmonizer consumes this catalog to drive label-based resolution against the
``dictionary_lake.parquet`` generated by ``01_ingest_dictionaries.py``. When
``download_ipeds.py`` refreshes yearly manifests, ``harmonize_new`` can combine
those manifests with the concept catalog to locate and parse the correct survey
files without editing legacy modules.
"""

from __future__ import annotations

from collections import OrderedDict
import re


GLOBAL_EXCLUDE = re.compile(r"^(unitid|instnm|opeid.*|^id$)", re.I)


CONCEPTS: "OrderedDict[str, dict[str, object]]" = OrderedDict(
    {
        # =====================================================
        # Institutional Characteristics (IC/HD) — Directory info
        # =====================================================
        "dir_inst_name": {
            "target_var": "dir_inst_name",
            "concept": "Institution name",
            "units": "text",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "label_regex": [r"^institution.*name$|^name of institution$"],
            "exclude_regex": [r"contact|mission|website|alias|short name|athletic|library"],
        },
        "dir_city": {
            "target_var": "dir_city",
            "concept": "City",
            "units": "text",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "label_regex": [r"^city(?: location of institution)?$"],
            "exclude_regex": [r"mailing|county|country"],
        },
        "dir_state_abbr": {
            "target_var": "dir_state_abbr",
            "concept": "State abbreviation",
            "units": "text",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "label_regex": [r"^state abbreviation$|^state$"],
            "exclude_regex": [r"fips|county"],
        },
        "dir_zip": {
            "target_var": "dir_zip",
            "concept": "ZIP code",
            "units": "text",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "label_regex": [r"^zip code$|^zip$"],
            "exclude_regex": [r"plus|mailing"],
        },
        "dir_ein": {
            "target_var": "dir_ein",
            "concept": "Employer Identification Number",
            "units": "text",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "label_regex": [r"^employer identification number$|^ein$"],
            "exclude_regex": [],
        },
        "dir_opeflag": {
            "target_var": "dir_opeflag",
            "concept": "OPE Title IV eligibility indicator code",
            "units": "code",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "label_regex": [r"^ope title iv eligibility indicator code$|^title iv participant$"],
            "exclude_regex": [],
        },
        "dir_opeid": {
            "target_var": "dir_opeid",
            "concept": "Office of Postsecondary Education (OPE) ID number",
            "units": "id",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "label_regex": [r"^ope id number$|^office of postsecondary education.*id number$"],
            "exclude_regex": [],
        },
        "dir_multi_campus_org": {
            "target_var": "dir_multi_campus_org",
            "concept": "Multi-institution or multi-campus organization indicator",
            "units": "code",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "label_regex": [r"^multi[- ]institution or multi[- ]campus organization$"],
            "exclude_regex": [],
        },
        "dir_multi_campus_id": {
            "target_var": "dir_multi_campus_id",
            "concept": "ID of multi-institution or multi-campus organization",
            "units": "id",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "min_year": 2013,
            "label_regex": [r"^identification number of multi[- ]institution or multi[- ]campus organization$"],
            "exclude_regex": [],
        },
        "dir_county_fips": {
            "target_var": "dir_county_fips",
            "concept": "County FIPS code",
            "units": "code",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "min_year": 2009,
            "label_regex": [r"^fips county code$|^county fips code$"],
            "exclude_regex": [],
        },
        "dir_county_name": {
            "target_var": "dir_county_name",
            "concept": "County name",
            "units": "text",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "min_year": 2009,
            "label_regex": [r"^county name$"],
            "exclude_regex": [],
        },
        "dir_congress_district": {
            "target_var": "dir_congress_district",
            "concept": "Congressional district code",
            "units": "code",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "min_year": 2009,
            "label_regex": [r"^congressional district code$"],
            "exclude_regex": [],
        },
        "dir_cbsa_code": {
            "target_var": "dir_cbsa_code",
            "concept": "Core Based Statistical Area (CBSA)",
            "units": "code",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "label_regex": [r"^core based statistical area.*$|^cbsa$"],
            "exclude_regex": [],
        },
        "dir_cbsa_type": {
            "target_var": "dir_cbsa_type",
            "concept": "CBSA type (metropolitan or micropolitan)",
            "units": "code",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "label_regex": [r"^cbsa type.*metropolitan or micropolitan$|^cbsa type$"],
            "exclude_regex": [],
        },
        "dir_csa_code": {
            "target_var": "dir_csa_code",
            "concept": "Combined Statistical Area (CSA)",
            "units": "code",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "label_regex": [r"^combined statistical area.*$|^csa$"],
            "exclude_regex": [],
        },
        "dir_necta_code": {
            "target_var": "dir_necta_code",
            "concept": "New England City and Town Areas (NECTA)",
            "units": "code",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "label_regex": [r"^new england city and town areas.*$|^necta.*$"],
            "exclude_regex": [],
        },
        "dir_longitude": {
            "target_var": "dir_longitude",
            "concept": "Longitude",
            "units": "text",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "min_year": 2009,
            "label_regex": [r"^longitude.*location of institution$|^longitude$"],
            "exclude_regex": [],
        },
        "dir_latitude": {
            "target_var": "dir_latitude",
            "concept": "Latitude",
            "units": "text",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "min_year": 2009,
            "label_regex": [r"^latitude.*location of institution$|^latitude$"],
            "exclude_regex": [],
        },
        "ic_open_public": {
            "target_var": "ic_open_public",
            "concept": "Institution open to the general public",
            "units": "code",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "label_regex": [r"^institution open to the general public$"],
            "exclude_regex": [],
        },
        "ic_active_in_year": {
            "target_var": "ic_active_in_year",
            "concept": "Institution is active in current year",
            "units": "code",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "label_regex": [r"^institution is active in current year$|^status of institution$"],
            "exclude_regex": [],
        },

        # =====================================================
        # Institutional classifications
        # =====================================================
        "ic_sector": {
            "target_var": "ic_sector",
            "concept": "Sector of institution",
            "units": "code",
            "survey": "InstitutionalCharacteristics",
            "period_type": "static",
            "label_regex": [r"^sector of institution$|^sector$"],
            "exclude_regex": [],
        },
        "ic_control": {
            "target_var": "ic_control",
            "concept": "Control of institution",
            "units": "code",
            "survey": "InstitutionalCharacteristics",
            "period_type": "static",
            "label_regex": [r"^control of institution$|^control$"],
            "exclude_regex": [],
        },
        "ic_level": {
            "target_var": "ic_level",
            "concept": "Level of institution",
            "units": "code",
            "survey": "InstitutionalCharacteristics",
            "period_type": "static",
            "label_regex": [r"^level of institution$|^institution level$"],
            "exclude_regex": [],
        },
        "ic_degree_granting": {
            "target_var": "ic_degree_granting",
            "concept": "Degree-granting status",
            "units": "code",
            "survey": "InstitutionalCharacteristics",
            "period_type": "static",
            "label_regex": [r"^degree[- ]granting status$"],
            "exclude_regex": [],
        },
        "ic_highest_degree_offered": {
            "target_var": "ic_highest_degree_offered",
            "concept": "Highest degree offered",
            "units": "code",
            "survey": "InstitutionalCharacteristics",
            "period_type": "static",
            "label_regex": [r"^highest degree offered.*$"],
            "exclude_regex": [],
            "notes": "Label revised in 2009-10; regex tolerates both versions.",
        },
        "ic_institutional_category": {
            "target_var": "ic_institutional_category",
            "concept": "Institutional category",
            "units": "code",
            "survey": "InstitutionalCharacteristics",
            "period_type": "static",
            "label_regex": [r"^institutional category$"],
            "exclude_regex": [],
        },
        "ic_highest_level_offering": {
            "target_var": "ic_highest_level_offering",
            "concept": "Highest level of offering",
            "units": "code",
            "survey": "InstitutionalCharacteristics",
            "period_type": "static",
            "label_regex": [r"^highest level of offering$"],
            "exclude_regex": [],
        },
        "ic_ug_offering": {
            "target_var": "ic_ug_offering",
            "concept": "Undergraduate offering",
            "units": "code",
            "survey": "InstitutionalCharacteristics",
            "period_type": "static",
            "label_regex": [r"^undergraduate offering$"],
            "exclude_regex": [],
        },
        "ic_gr_offering": {
            "target_var": "ic_gr_offering",
            "concept": "Graduate offering",
            "units": "code",
            "survey": "InstitutionalCharacteristics",
            "period_type": "static",
            "label_regex": [r"^graduate offering$"],
            "exclude_regex": [],
        },
        "ic_urbanicity": {
            "target_var": "ic_urbanicity",
            "concept": "Degree of urbanization (urban-centric locale)",
            "units": "code",
            "survey": "InstitutionalCharacteristics",
            "period_type": "static",
            "label_regex": [r"^degree of urbanization.*$|^urban[- ]?centric locale$|^urbanization$|^urbanicity$"],
            "exclude_regex": [],
        },

        # =====================================================
        # Control or affiliation
        # =====================================================
        "ic_affiliation": {
            "target_var": "ic_affiliation",
            "concept": "Institutional control or affiliation",
            "units": "code",
            "survey": "InstitutionalCharacteristics",
            "period_type": "static",
            "label_regex": [r"^institutional control or affiliation$"],
            "exclude_regex": [],
        },
        "ic_public_control_primary": {
            "target_var": "ic_public_control_primary",
            "concept": "Primary public control",
            "units": "code",
            "survey": "InstitutionalCharacteristics",
            "period_type": "static",
            "label_regex": [r"^primary public control$"],
            "exclude_regex": [],
        },
        "ic_public_control_secondary": {
            "target_var": "ic_public_control_secondary",
            "concept": "Secondary public control",
            "units": "code",
            "survey": "InstitutionalCharacteristics",
            "period_type": "static",
            "label_regex": [r"^secondary public control$"],
            "exclude_regex": [],
        },
        "ic_religious_affiliation": {
            "target_var": "ic_religious_affiliation",
            "concept": "Religious affiliation",
            "units": "code",
            "survey": "InstitutionalCharacteristics",
            "period_type": "static",
            "label_regex": [r"^religious affiliation$"],
            "exclude_regex": [],
        },

        # =====================================================
        # Response status / flags (IC)
        # =====================================================
        "ic_response_status": {
            "target_var": "ic_response_status",
            "concept": "Response status — IC component",
            "units": "code",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "label_regex": [r"^response status.*institutional characteristics$|^response status - institutional characteristics$"],
            "exclude_regex": [],
        },
        "ic_revision_status": {
            "target_var": "ic_revision_status",
            "concept": "Revision status — IC component",
            "units": "code",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "min_year": 2008,
            "max_year": 2023,
            "label_regex": [r"^revision status.*institutional characteristics component$"],
            "exclude_regex": [],
            "notes": "Applicable 2008-09 to 2022-23 per IC documentation.",
        },
        "ic_status_when_migrated": {
            "target_var": "ic_status_when_migrated",
            "concept": "Status of IC component when institution was migrated",
            "units": "code",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "label_regex": [r"^status of ic component when institution was migrated$"],
            "exclude_regex": [],
        },
        "ic_imputation_method": {
            "target_var": "ic_imputation_method",
            "concept": "Type of imputation method — IC",
            "units": "code",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "label_regex": [r"^type of imputation method.*institutional characteristics$|^imputation method.*institutional characteristics$"],
            "exclude_regex": [],
        },

        # =====================================================
        # Institutional Characteristics (IC) — COST (AY 2004–2023)
        # Tuition & required fees (UG/GR × in-district/in-state/out-of-state)
        # =====================================================
        "ic_tuition_ug_in_district": {
            "target_var": "ic_tuition_ug_in_district",
            "concept": "Undergraduate tuition and required fees — in-district",
            "units": "USD",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "min_year": 2004,
            "max_year": 2023,
            "label_regex": [
                r"^undergraduate.*in[- ]district.*tuition.*required fees$",
                r"^tuition.*required fees.*undergraduate.*in[- ]district$",
            ],
            "exclude_regex": [r"per (credit|unit|hour|course)", r"\bgraduate\b", r"\bcomprehensive fee\b"],
            "notes": "Public 2-yr often report in-district; missing at 4-yr is expected.",
        },
        "ic_tuition_ug_in_state": {
            "target_var": "ic_tuition_ug_in_state",
            "concept": "Undergraduate tuition and required fees — in-state",
            "units": "USD",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "min_year": 2004,
            "max_year": 2023,
            "label_regex": [
                r"^undergraduate.*in[- ]state.*tuition.*required fees$",
                r"^tuition.*required fees.*undergraduate.*in[- ]state$",
            ],
            "exclude_regex": [r"per (credit|unit|hour|course)", r"\bgraduate\b", r"\bcomprehensive fee\b"],
        },
        "ic_tuition_ug_out_state": {
            "target_var": "ic_tuition_ug_out_state",
            "concept": "Undergraduate tuition and required fees — out-of-state",
            "units": "USD",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "min_year": 2004,
            "max_year": 2023,
            "label_regex": [
                r"^undergraduate.*out[- ]of[- ]state.*tuition.*required fees$",
                r"^tuition.*required fees.*undergraduate.*out[- ]of[- ]state$",
            ],
            "exclude_regex": [r"per (credit|unit|hour|course)", r"\bgraduate\b", r"\bcomprehensive fee\b"],
        },
        "ic_tuition_gr_in_district": {
            "target_var": "ic_tuition_gr_in_district",
            "concept": "Graduate tuition and required fees — in-district",
            "units": "USD",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "min_year": 2004,
            "max_year": 2023,
            "label_regex": [
                r"^graduate.*in[- ]district.*tuition.*required fees$",
                r"^tuition.*required fees.*graduate.*in[- ]district$",
            ],
            "exclude_regex": [r"per (credit|unit|hour|course)", r"\bundergraduate\b", r"\bcomprehensive fee\b"],
        },
        "ic_tuition_gr_in_state": {
            "target_var": "ic_tuition_gr_in_state",
            "concept": "Graduate tuition and required fees — in-state",
            "units": "USD",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "min_year": 2004,
            "max_year": 2023,
            "label_regex": [
                r"^graduate.*in[- ]state.*tuition.*required fees$",
                r"^tuition.*required fees.*graduate.*in[- ]state$",
            ],
            "exclude_regex": [r"per (credit|unit|hour|course)", r"\bundergraduate\b", r"\bcomprehensive fee\b"],
        },
        "ic_tuition_gr_out_state": {
            "target_var": "ic_tuition_gr_out_state",
            "concept": "Graduate tuition and required fees — out-of-state",
            "units": "USD",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "min_year": 2004,
            "max_year": 2023,
            "label_regex": [
                r"^graduate.*out[- ]of[- ]state.*tuition.*required fees$",
                r"^tuition.*required fees.*graduate.*out[- ]of[- ]state$",
            ],
            "exclude_regex": [r"per (credit|unit|hour|course)", r"\bundergraduate\b", r"\bcomprehensive fee\b"],
        },
        "ic_comprehensive_fee_ug": {
            "target_var": "ic_comprehensive_fee_ug",
            "concept": "Undergraduate comprehensive fee (tuition+fees combined)",
            "units": "USD",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "min_year": 2004,
            "max_year": 2023,
            "label_regex": [r"^undergraduate.*comprehensive fee$|^comprehensive fee.*undergraduate$"],
            "exclude_regex": [],
            "notes": "Use mutually exclusive with separate UG tuition+fees.",
        },
        "ic_comprehensive_fee_gr": {
            "target_var": "ic_comprehensive_fee_gr",
            "concept": "Graduate comprehensive fee (tuition+fees combined)",
            "units": "USD",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "min_year": 2004,
            "max_year": 2023,
            "label_regex": [r"^graduate.*comprehensive fee$|^comprehensive fee.*graduate$"],
            "exclude_regex": [],
            "notes": "Use mutually exclusive with separate GR tuition+fees.",
        },

        # =====================================================
        # COA totals by living arrangement (AY, IC)
        # =====================================================
        "ic_coa_on_campus": {
            "target_var": "ic_coa_on_campus",
            "concept": "COA total — on campus",
            "units": "USD",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "min_year": 2004,
            "max_year": 2023,
            "label_regex": [r"^cost of attendance.*on[- ]campus$|^coa.*on[- ]campus$"],
            "exclude_regex": [],
        },
        "ic_coa_off_campus_not_family": {
            "target_var": "ic_coa_off_campus_not_family",
            "concept": "COA total — off campus (not with family)",
            "units": "USD",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "min_year": 2004,
            "max_year": 2023,
            "label_regex": [
                r"^cost of attendance.*off[- ]campus.*(not with family|without family|not living with parents?)$",
                r"^coa.*off[- ]campus.*(not with family|without family|not living with parents?)$",
            ],
            "exclude_regex": [],
        },
        "ic_coa_off_campus_with_family": {
            "target_var": "ic_coa_off_campus_with_family",
            "concept": "COA total — off campus (with family)",
            "units": "USD",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "min_year": 2004,
            "max_year": 2023,
            "label_regex": [
                r"^cost of attendance.*off[- ]campus.*(with family|living with parents?)$",
                r"^coa.*off[- ]campus.*(with family|living with parents?)$",
            ],
            "exclude_regex": [],
        },

        # =====================================================
        # COA components (AY, IC)
        # =====================================================
        "ic_room_board_on_campus": {
            "target_var": "ic_room_board_on_campus",
            "concept": "Room and board (housing and meals) — on campus",
            "units": "USD",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "min_year": 2004,
            "max_year": 2023,
            "label_regex": [
                r"^(room and board|housing and meals).*on[- ]campus$",
            ],
            "exclude_regex": [],
        },
        "ic_room_charge_on_campus": {
            "target_var": "ic_room_charge_on_campus",
            "concept": "Typical room charge for academic year",
            "units": "USD",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "min_year": 2004,
            "max_year": 2023,
            "label_regex": [r"^typical room charge for academic year$"],
            "exclude_regex": [],
        },
        "ic_board_charge_on_campus": {
            "target_var": "ic_board_charge_on_campus",
            "concept": "Typical board charge for academic year",
            "units": "USD",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "min_year": 2004,
            "max_year": 2023,
            "label_regex": [r"^typical board charge for academic year$"],
            "exclude_regex": [],
        },
        "ic_room_board_combined_on_campus": {
            "target_var": "ic_room_board_combined_on_campus",
            "concept": "Combined charge for room and board",
            "units": "USD",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "min_year": 2004,
            "max_year": 2023,
            "label_regex": [r"^combined charge for room and board$"],
            "exclude_regex": [],
        },
        "ic_room_board_off_campus_not_family": {
            "target_var": "ic_room_board_off_campus_not_family",
            "concept": "Room and board — off campus (not with family)",
            "units": "USD",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "min_year": 2004,
            "max_year": 2023,
            "label_regex": [
                r"^(room and board|housing and meals).*off[- ]campus.*(not with family|without family|not living with parents?)$",
            ],
            "exclude_regex": [],
        },
        "ic_other_exp_on_campus": {
            "target_var": "ic_other_exp_on_campus",
            "concept": "Other expenses — on campus",
            "units": "USD",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "min_year": 2004,
            "max_year": 2023,
            "label_regex": [r"^other expenses.*on[- ]campus$"],
            "exclude_regex": [],
        },
        "ic_other_exp_off_campus_not_family": {
            "target_var": "ic_other_exp_off_campus_not_family",
            "concept": "Other expenses — off campus (not with family)",
            "units": "USD",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "min_year": 2004,
            "max_year": 2023,
            "label_regex": [r"^other expenses.*off[- ]campus.*(not with family|without family|not living with parents?)$"],
            "exclude_regex": [],
        },
        "ic_other_exp_off_campus_with_family": {
            "target_var": "ic_other_exp_off_campus_with_family",
            "concept": "Other expenses — off campus (with family)",
            "units": "USD",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "min_year": 2004,
            "max_year": 2023,
            "label_regex": [r"^other expenses.*off[- ]campus.*(with family|living with parents?)$"],
            "exclude_regex": [],
        },
        "ic_books_supplies": {
            "target_var": "ic_books_supplies",
            "concept": "Books and supplies",
            "units": "USD",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "min_year": 2004,
            "max_year": 2023,
            "label_regex": [r"^books? and supplies?$|^books?$|^supplies?$"],
            "exclude_regex": [],
        },

        # =====================================================
        # Institutional Characteristics (IC) — admissions & policy
        # =====================================================
        "ic_calendar_system": {
            "target_var": "ic_calendar_system",
            "concept": "Calendar system",
            "units": "code",
            "survey": "InstitutionalCharacteristics",
            "period_type": "static",
            "label_regex": [r"^calendar system$"],
            "exclude_regex": [],
            "transform": "identity",
        },
        "ic_tuition_charge_varies": {
            "target_var": "ic_tuition_charge_varies",
            "concept": "Tuition charge varies for in-district, in-state, out-of-state",
            "units": "code",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "min_year": 2006,
            "max_year": 2023,
            "label_regex": [r"^tuition charge varies for in[- ]district, in[- ]state, out[- ]of[- ]state students$"],
            "exclude_regex": [],
        },
        "ic_alt_tuition_any": {
            "target_var": "ic_alt_tuition_any",
            "concept": "Any alternative tuition plans offered",
            "units": "code",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "min_year": 2008,
            "max_year": 2023,
            "label_regex": [r"^any alternative tuition plans offered by institution$"],
            "exclude_regex": [],
        },
        "ic_alt_tuition_guaranteed": {
            "target_var": "ic_alt_tuition_guaranteed",
            "concept": "Tuition guaranteed plan offered",
            "units": "code",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "min_year": 2008,
            "max_year": 2023,
            "label_regex": [r"^tuition guaranteed plan$"],
            "exclude_regex": [],
        },
        "ic_alt_tuition_prepaid": {
            "target_var": "ic_alt_tuition_prepaid",
            "concept": "Prepaid tuition plan offered",
            "units": "code",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "min_year": 2008,
            "max_year": 2023,
            "label_regex": [r"^prepaid tuition plan$"],
            "exclude_regex": [],
        },
        "ic_alt_tuition_payment": {
            "target_var": "ic_alt_tuition_payment",
            "concept": "Tuition payment plan offered",
            "units": "code",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "min_year": 2008,
            "max_year": 2023,
            "label_regex": [r"^tuition payment plan$"],
            "exclude_regex": [],
        },
        "ic_alt_tuition_other": {
            "target_var": "ic_alt_tuition_other",
            "concept": "Other alternative tuition plan offered",
            "units": "code",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "min_year": 2008,
            "max_year": 2023,
            "label_regex": [r"^other alternative tuition plan$"],
            "exclude_regex": [],
        },
        "ic_promise_program_flag": {
            "target_var": "ic_promise_program_flag",
            "concept": "Participates in a Promise Program",
            "units": "code",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "min_year": 2022,
            "max_year": 2023,
            "label_regex": [r"^participates in a promise program$"],
            "exclude_regex": [],
        },
        "ic_open_admissions": {
            "target_var": "ic_open_admissions",
            "concept": "Open admissions policy",
            "units": "code",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "label_regex": [r"^open admissions?$|^open admissions? policy$|^open admission policy$"],
            "exclude_regex": [r"test|sat|act|requirement|recommend"],
            "transform": "identity",
        },
        "ic_distance_programs": {
            "target_var": "ic_distance_programs",
            "concept": "Offers distance education programs",
            "units": "code",
            "survey": "InstitutionalCharacteristics",
            "period_type": "AY",
            "label_regex": [r"^offers distance education programs?$|^distance education programs?$"],
            "exclude_regex": [],
            "transform": "identity",
        },
        "ic_parent_unitid": {
            "target_var": "ic_parent_unitid",
            "concept": "Parent UNITID",
            "units": "id",
            "survey": "InstitutionalCharacteristics",
            "period_type": "static",
            "label_regex": [r"^parent.*unitid$|^unitid of parent$|^parent id$"],
            "exclude_regex": [],
            "notes": "Feeds parent/child handling in harmonizer.",
            "transform": "identity",
        },
        "ic_hbcu_flag": {
            "target_var": "ic_hbcu_flag",
            "concept": "Historically Black College or University indicator",
            "units": "code",
            "survey": "InstitutionalCharacteristics",
            "period_type": "static",
            "label_regex": [r"^historically black college or university$|^hbcu$"],
            "exclude_regex": [],
            "transform": "identity",
        },
        "ic_tribal_flag": {
            "target_var": "ic_tribal_flag",
            "concept": "Tribal college indicator",
            "units": "code",
            "survey": "InstitutionalCharacteristics",
            "period_type": "static",
            "label_regex": [r"^tribal college$|^american indian.*tribal$"],
            "exclude_regex": [],
            "transform": "identity",
        },
        "ic_med_school_flag": {
            "target_var": "ic_med_school_flag",
            "concept": "Medical school indicator",
            "units": "code",
            "survey": "InstitutionalCharacteristics",
            "period_type": "static",
            "label_regex": [r"^medical school (?:indicator|flag)$|^has medical school$"],
            "exclude_regex": [],
            "transform": "identity",
        },
        # =========================
        # Finance (FY) — Revenues
        # =========================
        "fin_total_rev_invest_return": {
            "target_var": "fin_total_rev_invest_return",
            "concept": "Total revenues and investment return (aligned forms)",
            "units": "USD",
            "survey": "Finance",
            "period_type": "FY",
            "forms": ["F1A", "F2A", "F3A"],
            "label_regex": [
                r"^total revenues? (?:and )?investment return$",
                r"^total other revenues? (?:&|and) additions$",
                r"^total revenues?(?:,? operating and nonoperating)?.*investment (?:return|income).*$",
            ],
            "exclude_regex": [r"endowment (?:market )?value|net assets|position|balance sheet"],
            "notes": "Aligned summary line; older GASB forms label as 'other additions'.",
        },
        "fin_tuition_fees_net": {
            "target_var": "fin_tuition_fees_net",
            "concept": "Tuition & fees revenue, net of discounts & allowances",
            "units": "USD",
            "survey": "Finance",
            "period_type": "FY",
            "forms": ["F1A", "F2A", "F3A"],
            "label_regex": [
                r"^tuition (?:and )?fees,? after deducting (?:discounts|allowances)$",
                r"^tuition (?:and )?fees.*\(net\)$",
                r"^net tuition (?:and )?fees$",
            ],
            "exclude_regex": [r"\bgross\b|before deducting|discounts? and allowances$"],
            "notes": "Net revenue line; excludes contra-revenue allowances.",
        },
        "fin_federal_grants_contracts": {
            "target_var": "fin_federal_grants_contracts",
            "concept": "Federal grants and contracts revenue",
            "units": "USD",
            "survey": "Finance",
            "period_type": "FY",
            "forms": ["F1A", "F2A", "F3A"],
            "label_regex": [
                r"^federal grants? (?:and )?contracts?(?:[, ].*)?$",
                r"^grants? and contracts? from federal government.*$",
            ],
            "exclude_regex": [r"state|local|private|expenses?"],
        },
        "fin_state_grants_contracts": {
            "target_var": "fin_state_grants_contracts",
            "concept": "State grants and contracts revenue",
            "units": "USD",
            "survey": "Finance",
            "period_type": "FY",
            "forms": ["F1A", "F2A", "F3A"],
            "label_regex": [r"^state grants? (?:and )?contracts?(?:[, ].*)?$"],
            "exclude_regex": [r"federal|local|private|expenses?"],
        },
        "fin_local_grants_contracts": {
            "target_var": "fin_local_grants_contracts",
            "concept": "Local grants and contracts revenue",
            "units": "USD",
            "survey": "Finance",
            "period_type": "FY",
            "forms": ["F1A", "F2A", "F3A"],
            "label_regex": [r"^local grants? (?:and )?contracts?(?:[, ].*)?$"],
            "exclude_regex": [r"federal|state|private|expenses?"],
        },
        "fin_private_gifts_grants_contracts": {
            "target_var": "fin_private_gifts_grants_contracts",
            "concept": "Private gifts, grants, and contracts revenue",
            "units": "USD",
            "survey": "Finance",
            "period_type": "FY",
            "forms": ["F1A", "F2A", "F3A"],
            "label_regex": [
                r"^private gifts?, grants?,? (?:and )?contracts?$",
                r"^private gifts? and grants?$",
            ],
            "exclude_regex": [r"expenses?|endowment (?:market )?value|net assets"],
        },
        "fin_sales_ed_activities": {
            "target_var": "fin_sales_ed_activities",
            "concept": "Sales and services of educational activities",
            "units": "USD",
            "survey": "Finance",
            "period_type": "FY",
            "forms": ["F1A", "F2A", "F3A"],
            "label_regex": [r"^sales? and services? of educational activities$"],
            "exclude_regex": [r"expenses?"],
        },
        "fin_auxiliary_rev": {
            "target_var": "fin_auxiliary_rev",
            "concept": "Sales and services of auxiliary enterprises (revenue)",
            "units": "USD",
            "survey": "Finance",
            "period_type": "FY",
            "forms": ["F1A", "F2A", "F3A"],
            "label_regex": [
                r"^sales? and services? of auxiliary enterprises$",
                r"^auxiliary (?:enterprise|enterprises) revenues?$",
            ],
            "exclude_regex": [r"expenses?"],
        },
        "fin_hospital_rev": {
            "target_var": "fin_hospital_rev",
            "concept": "Hospital revenue",
            "units": "USD",
            "survey": "Finance",
            "period_type": "FY",
            "forms": ["F1A", "F2A", "F3A"],
            "label_regex": [r"^sales? and services? of hospitals$|^hospital revenue$"],
            "exclude_regex": [r"expenses?"],
        },
        "fin_investment_return": {
            "target_var": "fin_investment_return",
            "concept": "Investment return (income, gains, losses)",
            "units": "USD",
            "survey": "Finance",
            "period_type": "FY",
            "forms": ["F1A", "F2A", "F3A"],
            "label_regex": [r"^investment return(?:.*)$|^investment income(?:.*)$|^net investment (?:income|return)(?:.*)$"],
            "exclude_regex": [r"endowment (?:market )?value|assets"],
            "notes": "Flow; distinct from endowment asset balances.",
        },

        # =========================
        # Finance (FY) — Expenses
        # =========================
        "fin_instruction_exp": {
            "target_var": "fin_instruction_exp",
            "concept": "Instruction expenses",
            "units": "USD",
            "survey": "Finance",
            "period_type": "FY",
            "forms": ["F1A", "F2A", "F3A"],
            "label_regex": [r"^instruction(?:\s*expenses?)?$|^instruction\s*-\s*total$|^instruction\b.*expenses?.*$"],
            "exclude_regex": [r"revenue"],
        },
        "fin_research_exp": {
            "target_var": "fin_research_exp",
            "concept": "Research expenses",
            "units": "USD",
            "survey": "Finance",
            "period_type": "FY",
            "forms": ["F1A", "F2A", "F3A"],
            "label_regex": [r"^research(?:\s*expenses?)?$|^research\s*-\s*total$|^research\b.*expenses?.*$"],
            "exclude_regex": [r"revenue"],
        },
        "fin_public_service_exp": {
            "target_var": "fin_public_service_exp",
            "concept": "Public service expenses",
            "units": "USD",
            "survey": "Finance",
            "period_type": "FY",
            "forms": ["F1A", "F2A", "F3A"],
            "label_regex": [r"^public service(?:\s*expenses?)?$|^public service\s*-\s*total$|^public service\b.*expenses?.*$"],
            "exclude_regex": [r"revenue"],
        },
        "fin_academic_support_exp": {
            "target_var": "fin_academic_support_exp",
            "concept": "Academic support expenses",
            "units": "USD",
            "survey": "Finance",
            "period_type": "FY",
            "forms": ["F1A", "F2A", "F3A"],
            "label_regex": [r"^academic support(?:\s*expenses?)?$|^academic support\s*-\s*total$"],
            "exclude_regex": [r"revenue"],
        },
        "fin_student_services_exp": {
            "target_var": "fin_student_services_exp",
            "concept": "Student services expenses",
            "units": "USD",
            "survey": "Finance",
            "period_type": "FY",
            "forms": ["F1A", "F2A", "F3A"],
            "label_regex": [r"^student services(?:\s*expenses?)?$|^student services\s*-\s*total$"],
            "exclude_regex": [r"revenue"],
        },
        "fin_institutional_support_exp": {
            "target_var": "fin_institutional_support_exp",
            "concept": "Institutional support expenses",
            "units": "USD",
            "survey": "Finance",
            "period_type": "FY",
            "forms": ["F1A", "F2A", "F3A"],
            "label_regex": [r"^institutional support(?:\s*expenses?)?$|^institutional support\s*-\s*total$"],
            "exclude_regex": [r"revenue"],
        },
        "fin_om_plant_exp": {
            "target_var": "fin_om_plant_exp",
            "concept": "Operation and maintenance of plant expenses",
            "units": "USD",
            "survey": "Finance",
            "period_type": "FY",
            "forms": ["F1A", "F2A", "F3A"],
            "label_regex": [r"^operations? and maintenance of plant(?:\s*expenses?)?.*$|^operation and maintenance.*$"],
            "exclude_regex": [r"revenue"],
        },
        "fin_scholarships_fellowships_exp": {
            "target_var": "fin_scholarships_fellowships_exp",
            "concept": "Scholarships and fellowships (expense)",
            "units": "USD",
            "survey": "Finance",
            "period_type": "FY",
            "forms": ["F1A", "F2A", "F3A"],
            "label_regex": [r"^scholarships? (?:and )?fellowships?(?:\s*expenses?)?.*$"],
            "exclude_regex": [r"revenues?|allowances|discounts?"],
            "notes": "Expense functional line; excludes contra-revenue allowances.",
        },
        "fin_auxiliary_exp": {
            "target_var": "fin_auxiliary_exp",
            "concept": "Auxiliary enterprises expenses",
            "units": "USD",
            "survey": "Finance",
            "period_type": "FY",
            "forms": ["F1A", "F2A", "F3A"],
            "label_regex": [r"^auxiliary (?:enterprise|enterprises) expenses?$|^auxiliary enterprises\s*-\s*total$"],
            "exclude_regex": [r"revenue"],
        },
        "fin_hospital_exp": {
            "target_var": "fin_hospital_exp",
            "concept": "Hospital services expenses",
            "units": "USD",
            "survey": "Finance",
            "period_type": "FY",
            "forms": ["F1A", "F2A", "F3A"],
            "label_regex": [r"^hospitals?(?:\s*expenses?)?$|^hospitals?\s*-\s*total$"],
            "exclude_regex": [r"revenue"],
        },
        "fin_depreciation_exp": {
            "target_var": "fin_depreciation_exp",
            "concept": "Depreciation expense",
            "units": "USD",
            "survey": "Finance",
            "period_type": "FY",
            "forms": ["F1A", "F2A", "F3A"],
            "label_regex": [r"^depreciation(?:\s*expenses?)?$|^depreciation\s*-\s*total$"],
        },
        "fin_interest_exp": {
            "target_var": "fin_interest_exp",
            "concept": "Interest expense",
            "units": "USD",
            "survey": "Finance",
            "period_type": "FY",
            "forms": ["F1A", "F2A", "F3A"],
            "label_regex": [r"^interest(?:\s*expenses?)?$|^interest\s*-\s*total$"],
        },
        "fin_total_exp": {
            "target_var": "fin_total_exp",
            "concept": "Total expenses (aligned forms)",
            "units": "USD",
            "survey": "Finance",
            "period_type": "FY",
            "forms": ["F1A", "F2A", "F3A"],
            "label_regex": [r"^total expenses?(?: and deductions)?$|^total expenses?$"],
        },

        # =========================
        # Finance (FY) — Allowances & Endowment
        # =========================
        "fin_allowances_tuition": {
            "target_var": "fin_allowances_tuition",
            "concept": "Discounts and allowances applied to tuition & fees",
            "units": "USD",
            "survey": "Finance",
            "period_type": "FY",
            "forms": ["F1A", "F2A", "F3A"],
            "label_regex": [r"^discounts? and allowances applied to tuition (?:and )?fees$"],
        },
        "fin_allowances_aux": {
            "target_var": "fin_allowances_aux",
            "concept": "Discounts and allowances applied to auxiliary revenues",
            "units": "USD",
            "survey": "Finance",
            "period_type": "FY",
            "forms": ["F1A", "F2A", "F3A"],
            "label_regex": [r"^discounts? and allowances applied to (sales and services of )?auxiliary (?:enterprise|enterprises) revenues?$"],
        },
        "fin_endowment_assets_boy_eoy": {
            "target_var": "fin_endowment_assets_boy_eoy",
            "concept": "Endowment assets (beginning and end of year)",
            "units": "USD",
            "survey": "Finance",
            "period_type": "FY",
            "forms": ["F1A", "F2A"],
            "label_regex": [r"^value of endowment assets at the (beginning|end) of the fiscal year$|^endowment assets$"],
            "exclude_regex": [r"investment return|income|gain|loss"],
            "notes": "Stock measure; pair with fin_investment_return for flows.",
        },

        # =========================
        # Finance (FY) — Meta / status
        # =========================
        "fin_reporting_standard": {
            "target_var": "fin_reporting_standard",
            "concept": "Reporting standards used to report Finance",
            "units": "text",
            "survey": "Finance",
            "period_type": "FY",
            "forms": ["F1A", "F2A", "F3A"],
            "label_regex": [r"^reporting standards used to report finance data$|^reporting standard$"],
        },
        "fin_fy_begin_date": {
            "target_var": "fin_fy_begin_date",
            "concept": "Beginning date of fiscal year covered",
            "units": "text",
            "survey": "Finance",
            "period_type": "FY",
            "forms": ["F1A", "F2A", "F3A"],
            "label_regex": [r"^beginning date of fiscal year covered$|^begin date of fiscal year$"],
        },
        "fin_fy_end_date": {
            "target_var": "fin_fy_end_date",
            "concept": "Ending date of fiscal year covered",
            "units": "text",
            "survey": "Finance",
            "period_type": "FY",
            "forms": ["F1A", "F2A", "F3A"],
            "label_regex": [r"^end date of fiscal year covered$|^ending date of fiscal year$"],
        },
        "fin_response_status": {
            "target_var": "fin_response_status",
            "concept": "Response status — Finance component",
            "units": "code",
            "survey": "Finance",
            "period_type": "FY",
            "forms": ["F1A", "F2A", "F3A"],
            "label_regex": [r"^response status.*finance$"],
        },
        "fin_revision_status": {
            "target_var": "fin_revision_status",
            "concept": "Revision status — Finance component",
            "units": "code",
            "survey": "Finance",
            "period_type": "FY",
            "forms": ["F1A", "F2A", "F3A"],
            "label_regex": [r"^revision status.*finance$"],
        },
        "fin_parent_child_indicator": {
            "target_var": "fin_parent_child_indicator",
            "concept": "Parent/child indicator — Finance",
            "units": "code",
            "survey": "Finance",
            "period_type": "FY",
            "forms": ["F1A", "F2A", "F3A"],
            "label_regex": [r"^parent/child indicator.*finance$"],
        },
        "fin_parent_unitid": {
            "target_var": "fin_parent_unitid",
            "concept": "ID number of parent institution — Finance",
            "units": "id",
            "survey": "Finance",
            "period_type": "FY",
            "forms": ["F1A", "F2A", "F3A"],
            "label_regex": [r"^id number of parent institution.*finance$"],
        },

        # -------------------------
        # Enrollment — Fall snapshot (EF) & 12-month (E12)
        # -------------------------
        "ef_total": {
            "target_var": "ef_total",
            "concept": "All students total (fall snapshot)",
            "units": "count",
            "survey": "FallEnrollment",
            "period_type": "AY",
            "forms": ["EF"],
            "label_regex": [r"^all students total$|^grand total$|^total enrollment$|^total$"],
            "exclude_regex": [
                r"by race|ethnicity|sex|gender|age|residence|major field|program|level detail",
            ],
            "notes": "Fall snapshot grand total only.",
        },
        "ef_ug_total": {
            "target_var": "ef_ug_total",
            "concept": "Undergraduate total (fall)",
            "units": "count",
            "survey": "FallEnrollment",
            "period_type": "AY",
            "forms": ["EF"],
            "label_regex": [r"^undergraduate total$|^total undergraduate students$"],
            "exclude_regex": [r"graduate|by race|ethnicity|sex|gender|age|residence|major field"],
        },
        "ef_grad_total": {
            "target_var": "ef_grad_total",
            "concept": "Graduate and first-professional total (fall)",
            "units": "count",
            "survey": "FallEnrollment",
            "period_type": "AY",
            "forms": ["EF"],
            "label_regex": [r"^graduate (?:and first[- ]?professional )?total$|^graduate total$"],
            "exclude_regex": [r"undergraduate|by race|ethnicity|sex|gender|age|residence|major field"],
        },
        "ef_ug_degseek_total": {
            "target_var": "ef_ug_degseek_total",
            "concept": "Undergraduate degree/certificate-seeking total (fall)",
            "units": "count",
            "survey": "FallEnrollment",
            "period_type": "AY",
            "forms": ["EF"],
            "label_regex": [r"^undergraduate degree/?certificate[- ]seeking total$"],
            "exclude_regex": [r"by race|ethnicity|sex|gender|age|residence|major field"],
        },
        "ef_ftft_ug_total": {
            "target_var": "ef_ftft_ug_total",
            "concept": "Undergraduate first-time degree/cert seeking total (FTFT, fall)",
            "units": "count",
            "survey": "FallEnrollment",
            "period_type": "AY",
            "forms": ["EF"],
            "label_regex": [
                r"^undergraduate degree/?certificate[- ]seeking first time total$",
                r"^first time total$",
            ],
            "exclude_regex": [r"transfer|part[- ]?time|by race|ethnicity|sex|gender|residence|major field"],
        },
        "ef_full_time_total": {
            "target_var": "ef_full_time_total",
            "concept": "Full-time students total (fall)",
            "units": "count",
            "survey": "FallEnrollment",
            "period_type": "AY",
            "forms": ["EF"],
            "label_regex": [r"^full[- ]?time total$|^total full[- ]?time students$"],
            "exclude_regex": [r"part[- ]?time|by race|ethnicity|sex|gender|age|residence|major field"],
        },
        "ef_part_time_total": {
            "target_var": "ef_part_time_total",
            "concept": "Part-time students total (fall)",
            "units": "count",
            "survey": "FallEnrollment",
            "period_type": "AY",
            "forms": ["EF"],
            "label_regex": [r"^part[- ]?time total$|^total part[- ]?time students$"],
            "exclude_regex": [r"full[- ]?time|by race|ethnicity|sex|gender|age|residence|major field"],
        },
        "ef_de_exclusive": {
            "target_var": "ef_de_exclusive",
            "concept": "Students enrolled exclusively in distance education (fall)",
            "units": "count",
            "survey": "FallEnrollment",
            "period_type": "AY",
            "forms": ["EF"],
            "label_regex": [
                r"^students? (?:enrolled )?exclusively in distance education$",
                r"^exclusive distance education$",
            ],
            "exclude_regex": [],
        },
        "ef_de_some": {
            "target_var": "ef_de_some",
            "concept": "Students enrolled in some distance education (fall)",
            "units": "count",
            "survey": "FallEnrollment",
            "period_type": "AY",
            "forms": ["EF"],
            "label_regex": [
                r"^students? (?:enrolled )?in some distance education$",
                r"^some distance education$",
            ],
            "exclude_regex": [],
        },
        "ef_de_none": {
            "target_var": "ef_de_none",
            "concept": "Students not enrolled in any distance education (fall)",
            "units": "count",
            "survey": "FallEnrollment",
            "period_type": "AY",
            "forms": ["EF"],
            "label_regex": [
                r"^students? not enrolled in any distance education$",
                r"^no distance education$",
            ],
            "exclude_regex": [],
        },
        "ef_retention_ftft_full_time": {
            "target_var": "ef_retention_ftft_full_time",
            "concept": "First-time full-time undergraduate retention rate (next fall)",
            "units": "percent",
            "survey": "FallEnrollment",
            "period_type": "AY",
            "forms": ["EF"],
            "label_regex": [r"^retention rate.*first[- ]time.*full[- ]time.*undergraduate$"],
            "exclude_regex": [],
        },
        "ef_retention_ftft_part_time": {
            "target_var": "ef_retention_ftft_part_time",
            "concept": "First-time part-time undergraduate retention rate (next fall)",
            "units": "percent",
            "survey": "FallEnrollment",
            "period_type": "AY",
            "forms": ["EF"],
            "label_regex": [r"^retention rate.*first[- ]time.*part[- ]time.*undergraduate$"],
            "exclude_regex": [],
        },
        "ef_student_faculty_ratio": {
            "target_var": "ef_student_faculty_ratio",
            "concept": "Student-to-faculty ratio (fall snapshot)",
            "units": "ratio",
            "survey": "FallEnrollment",
            "period_type": "AY",
            "forms": ["EF"],
            "label_regex": [r"^student[- ]to[- ]faculty ratio$|^student/faculty ratio$"],
            "exclude_regex": [],
        },
        "ef_residence_state_ftft": {
            "target_var": "ef_residence_state_ftft",
            "concept": "FTFT degree/certificate-seeking undergraduates by state of residence at application (fall snapshot)",
            "units": "count",
            "survey": "FallEnrollment",
            "period_type": "AY",
            "forms": ["EF"],
            "family": "state_residence",
            "row_regex": [
                r"(?:^|.*)(state of residence.*)?(alabama|alaska|arizona|arkansas|california|colorado|connecticut|delaware|district of columbia|florida|georgia|hawaii|idaho|illinois|indiana|iowa|kansas|kentucky|louisiana|maine|maryland|massachusetts|michigan|minnesota|mississippi|missouri|montana|nebraska|nevada|new hampshire|new jersey|new mexico|new york|north carolina|north dakota|ohio|oklahoma|oregon|pennsylvania|rhode island|south carolina|south dakota|tennessee|texas|utah|vermont|virginia|washington|west virginia|wisconsin|wyoming|puerto rico|guam|american samoa|northern mariana islands|u\.s\. virgin islands)(?:$|.*)"
            ],
            "exclude_regex": [
                r"percent|percentage|ratio|migration|net migration|in[- ]state %|out[- ]of[- ]state %|foreign|country|unknown"
            ],
            "notes": "Emits one long row per state via family=state_residence. Counts first-time degree/cert seeking undergraduates by state of residence at application.",
        },

        # =====================================================
        # 12-Month Enrollment (E12/E1D/EFFY/EFIA) — AY
        # =====================================================
        "e12_undup_total": {
            "target_var": "e12_undup_total",
            "concept": "12-month unduplicated headcount — all students",
            "units": "count",
            "survey": "12MonthEnrollment",
            "period_type": "AY",
            "forms": ["E12", "E1D", "EFFY", "EFIA"],
            "label_regex": [r"^grand total$|^all students total$|^total$"],
            "exclude_regex": [r"\bfall\b|\bsnapshot\b|residence|migration|race|ethnicity|sex|gender"],
        },
        "e12_ug_undup": {
            "target_var": "e12_ug_undup",
            "concept": "12-month unduplicated headcount — undergraduate",
            "units": "count",
            "survey": "12MonthEnrollment",
            "period_type": "AY",
            "forms": ["E12", "E1D", "EFFY", "EFIA"],
            "label_regex": [r"^undergraduate.*unduplicated headcount$|^unduplicated.*undergraduate$"],
            "exclude_regex": [r"\bfall\b|graduate|residence|migration|race|ethnicity|sex|gender"],
        },
        "e12_gr_undup": {
            "target_var": "e12_gr_undup",
            "concept": "12-month unduplicated headcount — graduate/first-professional",
            "units": "count",
            "survey": "12MonthEnrollment",
            "period_type": "AY",
            "forms": ["E12", "E1D", "EFFY", "EFIA"],
            "label_regex": [r"^graduate.*unduplicated headcount$|^unduplicated.*graduate$"],
            "exclude_regex": [r"\bfall\b|undergraduate|residence|migration|race|ethnicity|sex|gender"],
        },
        "e12_credit_hours_ug": {
            "target_var": "e12_credit_hours_ug",
            "concept": "Undergraduate credit hours during 12-month period",
            "units": "hours",
            "survey": "12MonthEnrollment",
            "period_type": "AY",
            "forms": ["E12", "E1D", "EFFY", "EFIA"],
            "label_regex": [r"^undergraduate.*credit hours?$|^credit hours.*undergraduate$"],
            "exclude_regex": [r"contact hours?|clock hours?|graduate|\bfall\b"],
        },
        "e12_credit_hours_gr": {
            "target_var": "e12_credit_hours_gr",
            "concept": "Graduate credit hours during 12-month period",
            "units": "hours",
            "survey": "12MonthEnrollment",
            "period_type": "AY",
            "forms": ["E12", "E1D", "EFFY", "EFIA"],
            "label_regex": [r"^graduate.*credit hours?$|^credit hours.*graduate$"],
            "exclude_regex": [r"contact hours?|clock hours?|undergraduate|\bfall\b"],
        },
        "e12_contact_hours_ug": {
            "target_var": "e12_contact_hours_ug",
            "concept": "Undergraduate contact/clock hours during 12-month period",
            "units": "hours",
            "survey": "12MonthEnrollment",
            "period_type": "AY",
            "forms": ["E12", "E1D", "EFFY", "EFIA"],
            "label_regex": [r"^undergraduate.*(contact|clock) hours?$|^(contact|clock) hours.*undergraduate$"],
            "exclude_regex": [r"credit hours?|graduate|\bfall\b"],
        },
        "e12_contact_hours_gr": {
            "target_var": "e12_contact_hours_gr",
            "concept": "Graduate contact/clock hours during 12-month period",
            "units": "hours",
            "survey": "12MonthEnrollment",
            "period_type": "AY",
            "forms": ["E12", "E1D", "EFFY", "EFIA"],
            "label_regex": [r"^graduate.*(contact|clock) hours?$|^(contact|clock) hours.*graduate$"],
            "exclude_regex": [r"credit hours?|undergraduate|\bfall\b"],
        },
        "e12_fte": {
            "target_var": "e12_fte",
            "concept": "Full-time equivalent (FTE) — 12-month (derived from instructional activity)",
            "units": "FTE",
            "survey": "12MonthEnrollment",
            "period_type": "AY",
            "forms": ["E12", "E1D", "EFFY", "EFIA"],
            "label_regex": [
                r"^full[- ]?time equivalent.*$",
                r"^fte.*enrollment.*$",
                r"^total 12[- ]?month full[- ]?time equivalent.*$",
            ],
            "exclude_regex": [r"\bfall\b|\bsnapshot\b|unduplicated headcount|residence|race|ethnicity|sex|gender"],
            "notes": "Calculated from credit/clock hours per IPEDS methodology; not fall FTE.",
        },
        "e12_hs_students_for_credit": {
            "target_var": "e12_hs_students_for_credit",
            "concept": "High school students enrolled in college courses for credit (12-month reporting)",
            "units": "count",
            "survey": "12MonthEnrollment",
            "period_type": "AY",
            "forms": ["E12"],
            "min_year": 2024,
            "label_regex": [r"^high school students? enrolled in college courses for credit.*$"],
            "exclude_regex": [],
            "notes": "Screen moved from IC to E12 beginning 2024-25.",
        },
        "e12_response_status": {
            "target_var": "e12_response_status",
            "concept": "Response status — 12-month Enrollment",
            "units": "code",
            "survey": "12MonthEnrollment",
            "period_type": "AY",
            "forms": ["E12"],
            "label_regex": [r"^response status.*12[- ]?month enrollment$|^response status of institution - 12[- ]?month enrollment$"],
            "exclude_regex": [],
        },
        "e12_revision_status": {
            "target_var": "e12_revision_status",
            "concept": "Revision status — 12-month Enrollment",
            "units": "code",
            "survey": "12MonthEnrollment",
            "period_type": "AY",
            "forms": ["E12"],
            "label_regex": [r"^revision status.*12[- ]?month enrollment$"],
            "exclude_regex": [],
        },
        "e12_parent_child_indicator": {
            "target_var": "e12_parent_child_indicator",
            "concept": "Parent/child indicator — 12-month Enrollment",
            "units": "code",
            "survey": "12MonthEnrollment",
            "period_type": "AY",
            "forms": ["E12"],
            "label_regex": [r"^parent/child indicator.*12[- ]?month enrollment$"],
            "exclude_regex": [],
        },
        "e12_parent_unitid": {
            "target_var": "e12_parent_unitid",
            "concept": "Parent institution UNITID — 12-month Enrollment",
            "units": "id",
            "survey": "12MonthEnrollment",
            "period_type": "AY",
            "forms": ["E12"],
            "label_regex": [r"^id number of parent institution.*12[- ]?month enrollment$|^parent institution id.*12[- ]?month enrollment$"],
            "exclude_regex": [],
        },
        "e12_imputation_method": {
            "target_var": "e12_imputation_method",
            "concept": "Type of imputation method — 12-month Enrollment",
            "units": "code",
            "survey": "12MonthEnrollment",
            "period_type": "AY",
            "forms": ["E12"],
            "label_regex": [r"^type of imputation method.*12[- ]?month enrollment$|^imputation method.*12[- ]?month enrollment$"],
            "exclude_regex": [],
        },
        "e12_reporting_period": {
            "target_var": "e12_reporting_period",
            "concept": "12-month reporting period descriptor",
            "units": "text",
            "survey": "12MonthEnrollment",
            "period_type": "AY",
            "forms": ["E12"],
            "label_regex": [r"^12[- ]?month reporting period.*$|^reporting period.*12[- ]?month enrollment$"],
            "exclude_regex": [],
        },

        # ===========================================
        # Admissions (ADM) — Applicants / Admits / Enrolled
        # ===========================================
        "adm_applicants_total": {
            "target_var": "adm_applicants_total",
            "concept": "Applicants total (first-time degree/cert-seeking)",
            "units": "count",
            "survey": "Admissions",
            "period_type": "AY",
            "label_regex": [r"^applicants total$|^total number of applicants$"],
            "exclude_regex": [r"transfer|graduate only|nondegree"],
        },
        "adm_admits_total": {
            "target_var": "adm_admits_total",
            "concept": "Admissions total (offers of admission)",
            "units": "count",
            "survey": "Admissions",
            "period_type": "AY",
            "label_regex": [r"^admissions? total$|^total number admitted$"],
            "exclude_regex": [r"transfer|graduate only|conditional"],
        },
        "adm_enrolled_ftft": {
            "target_var": "adm_enrolled_ftft",
            "concept": "Enrolled total (FTFT degree/cert-seeking)",
            "units": "count",
            "survey": "Admissions",
            "period_type": "AY",
            "label_regex": [
                r"^enrolled.*full[- ]?time.*first[- ]?time.*$",
                r"^enrolled total$",
            ],
            "exclude_regex": [r"part[- ]?time|transfer|graduate"],
            "notes": "Prefer the explicit FTFT row when both total and FTFT appear.",
        },

        # ===========================================
        # Admissions (ADM) — Test submission counts / percents
        # ===========================================
        "adm_sat_submit_count": {
            "target_var": "adm_sat_submit_count",
            "concept": "Number submitting SAT scores (FTFT)",
            "units": "count",
            "survey": "Admissions",
            "period_type": "AY",
            "label_regex": [r"^number of.*submitting sat scores$|^sat.*number submitting$"],
            "exclude_regex": [r"percent|percentage|avg|average"],
        },
        "adm_sat_submit_pct": {
            "target_var": "adm_sat_submit_pct",
            "concept": "Percent submitting SAT scores (FTFT)",
            "units": "percent",
            "survey": "Admissions",
            "period_type": "AY",
            "label_regex": [r"^percent of.*submitting sat scores$|^sat.*percent submitting$"],
            "exclude_regex": [r"number|count|avg|average"],
        },
        "adm_act_submit_count": {
            "target_var": "adm_act_submit_count",
            "concept": "Number submitting ACT scores (FTFT)",
            "units": "count",
            "survey": "Admissions",
            "period_type": "AY",
            "label_regex": [r"^number of.*submitting act scores$|^act.*number submitting$"],
            "exclude_regex": [r"percent|percentage|avg|average"],
        },
        "adm_act_submit_pct": {
            "target_var": "adm_act_submit_pct",
            "concept": "Percent submitting ACT scores (FTFT)",
            "units": "percent",
            "survey": "Admissions",
            "period_type": "AY",
            "label_regex": [r"^percent of.*submitting act scores$|^act.*percent submitting$"],
            "exclude_regex": [r"number|count|avg|average"],
        },

        # ===========================================
        # Admissions (ADM) — SAT percentiles (2016+ SAT)
        # ===========================================
        "sat_ebrw_p25": {
            "target_var": "sat_ebrw_p25",
            "concept": "SAT EBRW 25th percentile",
            "units": "score",
            "survey": "Admissions",
            "period_type": "AY",
            "min_year": 2016,
            "label_regex": [
                r"^sat.*evidence[- ]?based reading and writing.*25th percentile$",
                r"^sat.*ebrw.*25th percentile$",
            ],
            "exclude_regex": [r"75th|50th|avg|average|math|writing"],
        },
        "sat_ebrw_p75": {
            "target_var": "sat_ebrw_p75",
            "concept": "SAT EBRW 75th percentile",
            "units": "score",
            "survey": "Admissions",
            "period_type": "AY",
            "min_year": 2016,
            "label_regex": [
                r"^sat.*evidence[- ]?based reading and writing.*75th percentile$",
                r"^sat.*ebrw.*75th percentile$",
            ],
            "exclude_regex": [r"25th|50th|avg|average|math|writing"],
        },
        "sat_math_p25": {
            "target_var": "sat_math_p25",
            "concept": "SAT Math 25th percentile",
            "units": "score",
            "survey": "Admissions",
            "period_type": "AY",
            "min_year": 2016,
            "label_regex": [r"^sat math 25th percentile$|^sat.*math.*25th percentile$"],
            "exclude_regex": [r"75th|50th|avg|average|ebrw|writing"],
        },
        "sat_math_p75": {
            "target_var": "sat_math_p75",
            "concept": "SAT Math 75th percentile",
            "units": "score",
            "survey": "Admissions",
            "period_type": "AY",
            "min_year": 2016,
            "label_regex": [r"^sat math 75th percentile$|^sat.*math.*75th percentile$"],
            "exclude_regex": [r"25th|50th|avg|average|ebrw|writing"],
        },

        # ===========================================
        # Admissions (ADM) — ACT percentiles
        # ===========================================
        "act_comp_p25": {
            "target_var": "act_comp_p25",
            "concept": "ACT Composite 25th percentile",
            "units": "score",
            "survey": "Admissions",
            "period_type": "AY",
            "label_regex": [r"^act.*composite.*25th percentile$"],
            "exclude_regex": [r"75th|50th|avg|average|english|math|writing"],
        },
        "act_comp_p75": {
            "target_var": "act_comp_p75",
            "concept": "ACT Composite 75th percentile",
            "units": "score",
            "survey": "Admissions",
            "period_type": "AY",
            "label_regex": [r"^act.*composite.*75th percentile$"],
            "exclude_regex": [r"25th|50th|avg|average|english|math|writing"],
        },
        "act_eng_p25": {
            "target_var": "act_eng_p25",
            "concept": "ACT English 25th percentile",
            "units": "score",
            "survey": "Admissions",
            "period_type": "AY",
            "label_regex": [r"^act.*english.*25th percentile$"],
            "exclude_regex": [r"75th|50th|avg|average|composite|math|writing"],
        },
        "act_eng_p75": {
            "target_var": "act_eng_p75",
            "concept": "ACT English 75th percentile",
            "units": "score",
            "survey": "Admissions",
            "period_type": "AY",
            "label_regex": [r"^act.*english.*75th percentile$"],
            "exclude_regex": [r"25th|50th|avg|average|composite|math|writing"],
        },
        "act_math_p25": {
            "target_var": "act_math_p25",
            "concept": "ACT Math 25th percentile",
            "units": "score",
            "survey": "Admissions",
            "period_type": "AY",
            "label_regex": [r"^act.*math.*25th percentile$"],
            "exclude_regex": [r"75th|50th|avg|average|composite|english|writing"],
        },
        "act_math_p75": {
            "target_var": "act_math_p75",
            "concept": "ACT Math 75th percentile",
            "units": "score",
            "survey": "Admissions",
            "period_type": "AY",
            "label_regex": [r"^act.*math.*75th percentile$"],
            "exclude_regex": [r"25th|50th|avg|average|composite|english|writing"],
        },

        "adm_open_admissions": {
            "target_var": "adm_open_admissions",
            "concept": "Open admission policy (Admissions component)",
            "units": "code",
            "survey": "Admissions",
            "period_type": "AY",
            "label_regex": [r"^open admission policy$|^open admissions?$"],
            "exclude_regex": [],
            "notes": "ADM responses are typically omitted for institutions with open admission.",
        },

        # -------------------------
        # SFA (AY)
        # -------------------------
        "sfa_any_aid_recip_count": {
            "target_var": "sfa_any_aid_recip_count",
            "concept": "Undergraduates receiving any financial aid (FTFT focus in analysis)",
            "units": "count",
            "survey": "StudentFinancialAid",
            "period_type": "AY",
            "forms": ["SFA"],
            "label_regex": [
                r"^number of.*receiving any.*financial aid$",
                r"^students receiving any financial aid$",
            ],
            "exclude_regex": [r"amount|dollars|\$|average|per[- ]?recipient"],
        },
        "sfa_any_aid_amount": {
            "target_var": "sfa_any_aid_amount",
            "concept": "Total financial aid dollars (undergraduates)",
            "units": "USD",
            "survey": "StudentFinancialAid",
            "period_type": "AY",
            "forms": ["SFA"],
            "label_regex": [r"^total.*financial aid.*(amount|dollars|\$)$"],
            "exclude_regex": [r"average|per[- ]?recipient|number|recipients?"],
        },
        "sfa_federal_grant_amount": {
            "target_var": "sfa_federal_grant_amount",
            "concept": "Federal grants amount (undergraduates)",
            "units": "USD",
            "survey": "StudentFinancialAid",
            "period_type": "AY",
            "forms": ["SFA"],
            "label_regex": [r"^federal grants?.*(amount|dollars|\$|total)$"],
            "exclude_regex": [r"average|per[- ]?recipient|number|recipients?|pell"],
        },
        "sfa_federal_grant_recip_count": {
            "target_var": "sfa_federal_grant_recip_count",
            "concept": "Federal grants recipients (undergraduates)",
            "units": "count",
            "survey": "StudentFinancialAid",
            "period_type": "AY",
            "forms": ["SFA"],
            "label_regex": [r"^number of.*federal grants?.*recipients?$|^students receiving federal grants?$"],
            "exclude_regex": [r"amount|dollars|\$|average|per[- ]?recipient|pell"],
        },
        "sfa_state_local_grant_amount": {
            "target_var": "sfa_state_local_grant_amount",
            "concept": "State and local grants amount (undergraduates)",
            "units": "USD",
            "survey": "StudentFinancialAid",
            "period_type": "AY",
            "forms": ["SFA"],
            "label_regex": [r"^state (?:and )?local grants?.*(amount|dollars|\$|total)$"],
            "exclude_regex": [r"average|per[- ]?recipient|number|recipients?"],
        },
        "sfa_state_local_grant_recip_count": {
            "target_var": "sfa_state_local_grant_recip_count",
            "concept": "State and local grants recipients (undergraduates)",
            "units": "count",
            "survey": "StudentFinancialAid",
            "period_type": "AY",
            "forms": ["SFA"],
            "label_regex": [
                r"^number of.*state (?:and )?local grants?.*recipients?$",
                r"^students receiving state (?:and )?local grants?$",
            ],
            "exclude_regex": [r"amount|dollars|\$|average|per[- ]?recipient"],
        },
        "sfa_institutional_grant_amount": {
            "target_var": "sfa_institutional_grant_amount",
            "concept": "Institutional grants/scholarships amount (undergraduates)",
            "units": "USD",
            "survey": "StudentFinancialAid",
            "period_type": "AY",
            "forms": ["SFA"],
            "label_regex": [
                r"^institutional grants?.*(amount|dollars|\$|total)$",
                r"^institutional scholarships?.*(amount|dollars|\$)$",
            ],
            "exclude_regex": [r"average|per[- ]?recipient|number|recipients?"],
        },
        "sfa_institutional_grant_recip_count": {
            "target_var": "sfa_institutional_grant_recip_count",
            "concept": "Institutional grants/scholarships recipients (undergraduates)",
            "units": "count",
            "survey": "StudentFinancialAid",
            "period_type": "AY",
            "forms": ["SFA"],
            "label_regex": [
                r"^number of.*institutional grants?.*recipients?$",
                r"^students receiving institutional grants?$",
            ],
            "exclude_regex": [r"amount|dollars|\$|average|per[- ]?recipient"],
        },
        "sfa_direct_sub_loan_amount": {
            "target_var": "sfa_direct_sub_loan_amount",
            "concept": "Direct Subsidized Loans amount (undergraduates)",
            "units": "USD",
            "survey": "StudentFinancialAid",
            "period_type": "AY",
            "forms": ["SFA"],
            "label_regex": [
                r"^direct subsidized loans?.*(amount|dollars|\$|total)$",
                r"^subsidized.*direct loans?.*(amount|dollars|\$)$",
            ],
            "exclude_regex": [r"average|per[- ]?recipient|number|recipients?"],
            "notes": "FFEL ended 2010; legacy forms may label subsidized Stafford. Regex tolerates both.",
        },
        "sfa_direct_sub_loan_recip_count": {
            "target_var": "sfa_direct_sub_loan_recip_count",
            "concept": "Direct Subsidized Loans recipients (undergraduates)",
            "units": "count",
            "survey": "StudentFinancialAid",
            "period_type": "AY",
            "forms": ["SFA"],
            "label_regex": [
                r"^number of.*direct subsidized loans?.*recipients?$",
                r"^students receiving direct subsidized loans?$",
                r"^students receiving subsidized stafford$",
            ],
            "exclude_regex": [r"amount|dollars|\$|average|per[- ]?recipient"],
        },
        "sfa_direct_unsub_loan_amount": {
            "target_var": "sfa_direct_unsub_loan_amount",
            "concept": "Direct Unsubsidized Loans amount (undergraduates)",
            "units": "USD",
            "survey": "StudentFinancialAid",
            "period_type": "AY",
            "forms": ["SFA"],
            "label_regex": [
                r"^direct unsubsidized loans?.*(amount|dollars|\$|total)$",
                r"^unsubsidized.*direct loans?.*(amount|dollars|\$)$",
            ],
            "exclude_regex": [r"average|per[- ]?recipient|number|recipients?"],
        },
        "sfa_direct_unsub_loan_recip_count": {
            "target_var": "sfa_direct_unsub_loan_recip_count",
            "concept": "Direct Unsubsidized Loans recipients (undergraduates)",
            "units": "count",
            "survey": "StudentFinancialAid",
            "period_type": "AY",
            "forms": ["SFA"],
            "label_regex": [
                r"^number of.*direct unsubsidized loans?.*recipients?$",
                r"^students receiving direct unsubsidized loans?$",
            ],
            "exclude_regex": [r"amount|dollars|\$|average|per[- ]?recipient"],
        },
        "sfa_parent_plus_amount": {
            "target_var": "sfa_parent_plus_amount",
            "concept": "Parent PLUS amount (parents of undergraduates)",
            "units": "USD",
            "survey": "StudentFinancialAid",
            "period_type": "AY",
            "forms": ["SFA"],
            "label_regex": [
                r"^parent plus loans?.*(amount|dollars|\$|total)$",
                r"^plus loans.*parents?.*(amount|dollars|\$)$",
            ],
            "exclude_regex": [r"average|per[- ]?recipient|number|recipients?|graduate plus"],
        },
        "sfa_parent_plus_recip_count": {
            "target_var": "sfa_parent_plus_recip_count",
            "concept": "Parent PLUS recipients (parents of undergraduates)",
            "units": "count",
            "survey": "StudentFinancialAid",
            "period_type": "AY",
            "forms": ["SFA"],
            "label_regex": [
                r"^number of.*parent plus loans?.*recipients?$",
                r"^parents? receiving plus loans?$",
            ],
            "exclude_regex": [r"amount|dollars|\$|average|per[- ]?recipient|graduate plus"],
        },
        "sfa_private_loan_amount": {
            "target_var": "sfa_private_loan_amount",
            "concept": "Private (non-federal) student loans amount (undergraduates)",
            "units": "USD",
            "survey": "StudentFinancialAid",
            "period_type": "AY",
            "forms": ["SFA"],
            "label_regex": [r"^private loans?.*(amount|dollars|\$|total)$"],
            "exclude_regex": [r"average|per[- ]?recipient|number|recipients?"],
        },
        "sfa_private_loan_recip_count": {
            "target_var": "sfa_private_loan_recip_count",
            "concept": "Private loan recipients (undergraduates)",
            "units": "count",
            "survey": "StudentFinancialAid",
            "period_type": "AY",
            "forms": ["SFA"],
            "label_regex": [
                r"^number of.*private loans?.*recipients?$",
                r"^students receiving private loans?$",
            ],
            "exclude_regex": [r"amount|dollars|\$|average|per[- ]?recipient"],
        },
        "sfa_veterans_benefits_amount": {
            "target_var": "sfa_veterans_benefits_amount",
            "concept": "Veterans and military education benefits amount",
            "units": "USD",
            "survey": "StudentFinancialAid",
            "period_type": "AY",
            "forms": ["SFA"],
            "label_regex": [
                r"^(?:post[- ]?9/11 )?gi bill.*(amount|dollars|\$|total)$",
                r"^veterans?.*education benefits?.*(amount|dollars|\$|total)$",
                r"^military education benefits?.*(amount|dollars|\$|total)$",
            ],
            "exclude_regex": [r"average|per[- ]?recipient|number|recipients?"],
            "notes": "Collected separately from Title IV aid; includes GI Bill and related military benefits.",
        },
        "pell_recip_count": {
            "target_var": "pell_recip_count",
            "concept": "Pell Grant recipients (FTFT undergraduates)",
            "units": "count",
            "survey": "StudentFinancialAid",
            "period_type": "AY",
            "forms": ["SFA"],
            "min_year": 2009,
            "label_regex": [
                r"pell.*(?:recipients?|students (?:awarded|receiving)|number receiving).*full[- ]?time.*first[- ]?time",
                r".*full[- ]?time.*first[- ]?time.*pell.*",
            ],
            "exclude_regex": [
                r"amount|dollars|\$|average|per[- ]?recipient",
            ],
            "notes": "Restrict to FTFT cohort; exclude dollar amounts.",
            "transform": "identity",
        },
        "pell_amount": {
            "target_var": "pell_amount",
            "concept": "Pell Grant dollars",
            "units": "USD",
            "survey": "StudentFinancialAid",
            "period_type": "AY",
            "forms": ["SFA"],
            "min_year": 2009,
            "label_regex": [
                r"^pell grants?.*(amount|dollars|\$|total)$",
                r".*total amount.*pell grants?.*",
            ],
            "exclude_regex": [r"recipient|students|count|number", r"average|per[- ]?recipient"],
            "notes": "Total Pell dollars; exclude counts and averages.",
            "transform": "identity",
        },
        "sfa_ftft_in_district_count": {
            "target_var": "sfa_ftft_in_district_count",
            "concept": "FTFT undergraduates paying in-district tuition rate (fall cohort)",
            "units": "count",
            "survey": "StudentFinancialAid",
            "period_type": "AY",
            "forms": ["SFA"],
            "label_regex": [
                r"^number of students in fall cohort who are paying in[- ]district tuition rates$",
                r"^students.*in[- ]district tuition rates$",
            ],
            "exclude_regex": [r"percent|percentage|amount|\$"],
        },
        "sfa_ftft_in_state_count": {
            "target_var": "sfa_ftft_in_state_count",
            "concept": "FTFT undergraduates paying in-state tuition rate (fall cohort)",
            "units": "count",
            "survey": "StudentFinancialAid",
            "period_type": "AY",
            "forms": ["SFA"],
            "label_regex": [
                r"^number of students in fall cohort who are paying in[- ]state tuition rates$",
                r"^students.*in[- ]state tuition rates$",
            ],
            "exclude_regex": [r"percent|percentage|amount|\$"],
        },
        "sfa_ftft_out_state_count": {
            "target_var": "sfa_ftft_out_state_count",
            "concept": "FTFT undergraduates paying out-of-state tuition rate (fall cohort)",
            "units": "count",
            "survey": "StudentFinancialAid",
            "period_type": "AY",
            "forms": ["SFA"],
            "label_regex": [
                r"^number of students in fall cohort who are paying out[- ]of[- ]state tuition rates$",
                r"^students.*out[- ]of[- ]state tuition rates$",
            ],
            "exclude_regex": [r"percent|percentage|amount|\$"],
        },
        "sfa_ftft_unknown_rate_count": {
            "target_var": "sfa_ftft_unknown_rate_count",
            "concept": "FTFT undergraduates with unknown residence/tuition rate status (fall cohort)",
            "units": "count",
            "survey": "StudentFinancialAid",
            "period_type": "AY",
            "forms": ["SFA"],
            "label_regex": [
                r"^number of students in fall cohort whose residence/tuition rate status is unknown$",
            ],
            "exclude_regex": [r"percent|percentage|amount|\$"],
        },

        # Net price (AY, Title IV cohort; SFA historically, CST in recent years)
        "anp_all": {
            "target_var": "anp_all",
            "concept": "Average net price — all Title IV FTFT undergraduates",
            "units": "USD",
            "survey": "SFA",
            "period_type": "AY",
            "forms": ["SFA", "CST"],
            "min_year": 2009,
            "label_regex": [
                r"^average net price(?!.*by income).*title iv.*$",
                r"^average net price$",
            ],
            "exclude_regex": [
                r"average amount of grant.*scholarship",
                r"by income",
            ],
            "requires_keywords": ["net price"],
            "notes": "Title IV FTFT; SFA 2009–2023, CST 2024+.",
        },
        "anp_0_30": {
            "target_var": "anp_0_30",
            "concept": "Average net price 0–30k (Title IV)",
            "units": "USD",
            "survey": "SFA",
            "period_type": "AY",
            "forms": ["SFA", "CST"],
            "min_year": 2009,
            "label_regex": [
                r"average net price.*(?:less than\s*30[, ]?0{3}|0\s*[-–]\s*30[, ]?0{3}|0\s*to\s*30[, ]?0{3}|0\s*-\s*30k)",
                r"average net price.*title iv.*0.*30[, ]?000",
            ],
            "exclude_regex": [
                r"average amount of grant.*scholarship aid",
                r"\bgrant(?:s)? and scholarship(?:s)? aid\b",
                r"\bavg(?:erage)? amount\b",
            ],
            "requires_keywords": ["net price"],
            "notes": "Title IV band.",
            "transform": "identity",
            "band_min": 0,
            "band_max": 30000,
            "open_upper": False,
        },
        "anp_30_48": {
            "target_var": "anp_30_48",
            "concept": "Average net price 30–48k (Title IV)",
            "units": "USD",
            "survey": "SFA",
            "period_type": "AY",
            "forms": ["SFA", "CST"],
            "min_year": 2009,
            "label_regex": [
                r"average net price.*(?:30[, ]?0{3}?\s*(to|[-–])\s*48[, ]?0{3}|30[, ]?001\s*(to|[-–])\s*48[, ]?0{3})",
                r"average net price.*title iv.*30[, ]?001.*48[, ]?000",
            ],
            "exclude_regex": [
                r"average amount of grant.*scholarship aid",
                r"\bgrant(?:s)? and scholarship(?:s)? aid\b",
                r"\bavg(?:erage)? amount\b",
            ],
            "requires_keywords": ["net price"],
            "notes": "",
            "transform": "identity",
            "band_min": 30001,
            "band_max": 48000,
            "open_upper": False,
        },
        "anp_48_75": {
            "target_var": "anp_48_75",
            "concept": "Average net price 48–75k (Title IV)",
            "units": "USD",
            "survey": "SFA",
            "period_type": "AY",
            "forms": ["SFA", "CST"],
            "min_year": 2009,
            "label_regex": [
                r"average net price.*(?:48[, ]?0{3}?\s*(to|[-–])\s*75[, ]?0{3}|48[, ]?001\s*(to|[-–])\s*75[, ]?0{3})",
                r"average net price.*title iv.*48[, ]?001.*75[, ]?000",
            ],
            "exclude_regex": [
                r"average amount of grant.*scholarship aid",
                r"\bgrant(?:s)? and scholarship(?:s)? aid\b",
                r"\bavg(?:erage)? amount\b",
            ],
            "requires_keywords": ["net price"],
            "notes": "",
            "transform": "identity",
            "band_min": 48001,
            "band_max": 75000,
            "open_upper": False,
        },
        "anp_75_110": {
            "target_var": "anp_75_110",
            "concept": "Average net price 75–110k (Title IV)",
            "units": "USD",
            "survey": "SFA",
            "period_type": "AY",
            "forms": ["SFA", "CST"],
            "min_year": 2009,
            "label_regex": [
                r"average net price.*(?:75[, ]?0{3}?\s*(to|[-–])\s*110[, ]?0{3}|75[, ]?001\s*(to|[-–])\s*110[, ]?0{3})",
                r"average net price.*title iv.*75[, ]?001.*110[, ]?000",
            ],
            "exclude_regex": [
                r"average amount of grant.*scholarship aid",
                r"\bgrant(?:s)? and scholarship(?:s)? aid\b",
                r"\bavg(?:erage)? amount\b",
            ],
            "requires_keywords": ["net price"],
            "notes": "",
            "transform": "identity",
            "band_min": 75001,
            "band_max": 110000,
            "open_upper": False,
        },
        "anp_110_plus": {
            "target_var": "anp_110_plus",
            "concept": "Average net price 110k+ (Title IV)",
            "units": "USD",
            "survey": "SFA",
            "period_type": "AY",
            "forms": ["SFA", "CST"],
            "min_year": 2009,
            "label_regex": [
                r"average net price.*(110[, ]?0{3}\s*(or more|\+)|110[, ]?001\s*(or more|\+))",
                r"average net price.*(110[, ]?001|110[, ]?000 or more)",
            ],
            "exclude_regex": [
                r"average amount of grant.*scholarship aid",
                r"\bgrant(?:s)? and scholarship(?:s)? aid\b",
                r"\bavg(?:erage)? amount\b",
            ],
            "requires_keywords": ["net price"],
            "notes": "",
            "transform": "identity",
            "band_min": 110000,
            "band_max": None,
            "open_upper": True,
        },
    }
)
